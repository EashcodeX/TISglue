(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9689],{4710:(e,t,a)=>{Promise.resolve().then(a.bind(a,19351))},19351:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>r});var n=a(95155),i=a(12115),s=a(42099),o=a(45745);function r(){let[e,t]=(0,i.useState)([]),[a,r]=(0,i.useState)(""),[c,l]=(0,i.useState)({}),[d,m]=(0,i.useState)(!1),[u,h]=(0,i.useState)([]);(0,i.useEffect)(()=>{b()},[]);let g=e=>{h(t=>[...t,e])},b=async()=>{try{let{data:e,error:a}=await s.N.from("organizations").select("id, name").limit(10);if(a)throw a;t(e||[])}catch(e){}},f=async e=>{m(!0),h([]);try{g("\uD83D\uDD0D Testing sidebar counts for organization: ".concat(e));let t=await o.o.getOrganizationCounts(e);l(t),g("\uD83D\uDCCA Real counts from SidebarService:"),Object.entries(t).forEach(e=>{let[t,a]=e;g("  • ".concat(t,": ").concat(a))});let a=await o.o.getOrganizationSidebarByCategory(e);g("\uD83D\uDD0D Sidebar items with counts:"),Object.entries(a).forEach(e=>{let[t,a]=e;g("\uD83D\uDCC1 ".concat(t,":")),a.systemItems.forEach(e=>{void 0!==e.count&&g("  • ".concat(e.name,": ").concat(e.count))})})}catch(e){g("❌ Error: ".concat(e.message))}m(!1)},p=async e=>{m(!0),h([]);try{g("➕ Adding sample data to test counts...");let{error:t}=await s.N.from("contacts").insert([{organization_id:e,name:"John Doe",email:"john@example.com",phone:"555-0123",role:"IT Manager",department:"IT",title:"Manager"},{organization_id:e,name:"Jane Smith",email:"jane@example.com",phone:"555-0124",role:"Admin",department:"Administration",title:"Administrator"}]);t?g("⚠️ Contact error: ".concat(t.message)):g("✅ Added 2 sample contacts");let{error:a}=await s.N.from("locations").insert([{organization_id:e,name:"Main Office",address:"123 Business St, City, State 12345",type:"Office",phone:"555-0100",contact:"John Doe"},{organization_id:e,name:"Warehouse",address:"456 Storage Ave, City, State 12345",type:"Warehouse",phone:"555-0101",contact:"Jane Smith"}]);a?g("⚠️ Location error: ".concat(a.message)):g("✅ Added 2 sample locations");let{error:n}=await s.N.from("documents").insert([{organization_id:e,name:"IT Policy Document",description:"Company IT policies and procedures",file_type:"PDF"},{organization_id:e,name:"Network Diagram",description:"Current network topology",file_type:"PNG"},{organization_id:e,name:"User Manual",description:"Software user manual",file_type:"DOCX"}]);n?g("⚠️ Document error: ".concat(n.message)):g("✅ Added 3 sample documents"),o.o.clearCache(e),g("\uD83C\uDF89 Sample data added! Test counts again to see the changes.")}catch(e){g("❌ Error adding sample data: ".concat(e.message))}m(!1)};return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:[(0,n.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\uD83E\uDDEA Test Sidebar Counts"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Select Organization"}),(0,n.jsxs)("select",{value:a,onChange:e=>r(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white mb-4",children:[(0,n.jsx)("option",{value:"",children:"Select an organization..."}),e.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsx)("button",{onClick:()=>a&&f(a),disabled:!a||d,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded text-white",children:d?"Testing...":"\uD83D\uDD0D Test Real Counts"}),(0,n.jsx)("button",{onClick:()=>a&&p(a),disabled:!a||d,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded text-white",children:d?"Adding...":"➕ Add Sample Data"})]})]}),(0,n.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,n.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Current Counts"}),Object.keys(c).length>0?(0,n.jsx)("div",{className:"space-y-2",children:Object.entries(c).map(e=>{let[t,a]=e;return(0,n.jsxs)("div",{className:"flex justify-between items-center p-2 bg-gray-700 rounded",children:[(0,n.jsx)("span",{className:"capitalize",children:t.replace("_"," ")}),(0,n.jsx)("span",{className:"font-mono text-blue-400",children:a})]},t)})}):(0,n.jsx)("div",{className:"text-gray-400",children:"Select an organization and test counts"})]})]}),u.length>0&&(0,n.jsxs)("div",{className:"mt-8 bg-gray-800 p-6 rounded-lg",children:[(0,n.jsx)("h3",{className:"font-medium mb-4",children:"Test Results:"}),(0,n.jsx)("div",{className:"space-y-1 text-sm font-mono max-h-96 overflow-y-auto",children:u.map((e,t)=>(0,n.jsx)("div",{className:e.includes("✅")?"text-green-400":e.includes("❌")?"text-red-400":e.includes("⚠️")?"text-yellow-400":e.includes("\uD83C\uDF89")?"text-blue-400":e.includes("\uD83D\uDCCA")||e.includes("\uD83D\uDD0D")?"text-purple-400":"text-gray-300",children:e},t))})]}),(0,n.jsxs)("div",{className:"mt-8 bg-blue-900/20 border border-blue-600 rounded-lg p-6",children:[(0,n.jsx)("h3",{className:"text-blue-400 font-semibold mb-4",children:"\uD83C\uDFAF How to Test:"}),(0,n.jsxs)("ol",{className:"text-blue-200 text-sm space-y-2",children:[(0,n.jsxs)("li",{children:["1. ",(0,n.jsx)("strong",{children:"Select an organization"})," from the dropdown"]}),(0,n.jsxs)("li",{children:["2. ",(0,n.jsx)("strong",{children:'Click "Test Real Counts"'})," to see current counts"]}),(0,n.jsxs)("li",{children:["3. ",(0,n.jsx)("strong",{children:'Click "Add Sample Data"'})," to add test data"]}),(0,n.jsxs)("li",{children:["4. ",(0,n.jsx)("strong",{children:"Test counts again"})," to see the numbers increase"]}),(0,n.jsxs)("li",{children:["5. ",(0,n.jsx)("strong",{children:"Check the sidebar"})," in the main app to see real counts"]}),(0,n.jsxs)("li",{children:["6. ",(0,n.jsx)("strong",{children:"Switch organizations"})," to see different counts"]})]})]})]})}},42099:(e,t,a)=>{"use strict";a.d(t,{N:()=>n});let n=(0,a(55647).UU)("https://yhznjxfzpthmyyhbhihp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inloem5qeGZ6cHRobXl5aGJoaWhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDE0MzcsImV4cCI6MjA2OTgxNzQzN30.BlP9YoilaPopQgkZXZa-_WJPUIjnX9nTyYspaBV0Cqc")},45745:(e,t,a)=>{"use strict";a.d(t,{o:()=>i});var n=a(42099);class i{static async getOrganizationCounts(e){let t="counts_".concat(e),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;try{let a={},{count:i,error:s}=await n.N.from("contacts").select("*",{count:"exact",head:!0}).eq("organization_id",e);s||(a.contacts=i||0);let{count:o,error:r}=await n.N.from("locations").select("*",{count:"exact",head:!0}).eq("organization_id",e);r||(a.locations=o||0);let{count:c,error:l}=await n.N.from("documents").select("*",{count:"exact",head:!0}).eq("organization_id",e);l?a.documents=0:a.documents=c||0;let{count:d,error:m}=await n.N.from("passwords").select("*",{count:"exact",head:!0}).eq("organization_id",e);m?a.passwords=0:a.passwords=d||0;let{count:u,error:h}=await n.N.from("configurations").select("*",{count:"exact",head:!0}).eq("organization_id",e);h?a.configurations=0:a.configurations=u||0;let{count:g,error:b}=await n.N.from("networks").select("*",{count:"exact",head:!0}).eq("organization_id",e);b?a.networks=0:a.networks=g||0;let{count:f,error:p}=await n.N.from("ssl_certificates").select("*",{count:"exact",head:!0}).eq("organization_id",e);p?a.ssl_certificates=0:a.ssl_certificates=f||0;let{count:x,error:C}=await n.N.from("domains").select("*",{count:"exact",head:!0}).eq("organization_id",e);return C?a.domains=0:a.domains=x||0,this.cache.set(t,{data:a,timestamp:Date.now()}),a}catch(e){return{}}}static clearCache(e){e?(this.cache.delete("sidebar_".concat(e)),this.cache.delete("items_".concat(e)),this.cache.delete("counts_".concat(e))):this.cache.clear()}static clearCacheIfDifferentOrg(e){Array.from(this.cache.keys()).some(t=>t.includes("sidebar_")&&!t.includes(e))&&this.cache.clear()}static async getOrganizationSidebarItems(e){let t="items_".concat(e),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;let{data:i,error:s}=await n.N.from("organization_sidebar_items").select("*").eq("organization_id",e).eq("is_active",!0).order("sort_order",{ascending:!0});if(s)throw s;let o=i||[];return this.cache.set(t,{data:o,timestamp:Date.now()}),o}static async getOrganizationSidebarByCategory(e){let t="sidebar_".concat(e),a=this.cache.get(t);if(a&&Date.now()-a.timestamp<this.CACHE_DURATION)return a.data;let n=await this.getOrganizationSidebarItems(e),i=await this.getOrganizationCounts(e),s={"CLIENT CONTACT":{name:"CLIENT CONTACT",items:[],systemItems:[{name:"Site Summary",href:"/site-summary",icon:"FileText",count:1},{name:"Site Summary (Legacy)",href:"/site-summary-legacy",icon:"Archive",count:1},{name:"After Hour and Building/Site...",href:"/after-hour-access",icon:"Clock",count:1},{name:"Onsite Information",href:"/onsite-information",icon:"AlertTriangle"},{name:"Locations",href:"/locations",icon:"MapPin",count:i.locations||0},{name:"Contacts",href:"/contacts",icon:"Users",count:i.contacts||0}]},"CORE DOCUMENTATION":{name:"CORE DOCUMENTATION",items:[],systemItems:[{name:"TIS Standards Exception",href:"/tis-standards-exception",icon:"AlertTriangle"},{name:"TIS Contract Exceptions",href:"/tis-contract-exceptions",icon:"FileX"},{name:"Request for Change Form (RFC)",href:"/rfc",icon:"Clock"},{name:"Change Log",href:"/change-log",icon:"FileText"},{name:"Configurations",href:"/configurations",icon:"Settings",count:i.configurations||0},{name:"Documents",href:"/documents",icon:"FileText",count:i.documents||0},{name:"Domains - Liongard",href:"/domains-liongard",icon:"FileText",count:i.domains||0},{name:"Domain Tracker",href:"/domain-tracker",icon:"Globe",count:i.domains||0},{name:"Known Issues",href:"/known-issues",icon:"AlertTriangle",count:0},{name:"Maintenance Windows",href:"/maintenance-windows",icon:"Zap"},{name:"Multi-Factor Authentication",href:"/mfa",icon:"Shield",count:0},{name:"Networks",href:"/networks",icon:"Network",count:i.networks||0},{name:"Passwords",href:"/passwords",icon:"Key",count:i.passwords||0},{name:"SSL Tracker",href:"/ssl-tracker",icon:"Lock",count:i.ssl_certificates||0},{name:"TLS/SSL Certificate",href:"/tls-ssl-certificate",icon:"Shield",count:i.ssl_certificates||0}]}};return n.forEach(e=>{let t=e.parent_category||"CLIENT CONTACT";s[t]||(s[t]={name:t,items:[],systemItems:[]}),s[t].items.push(e)}),this.cache.set(t,{data:s,timestamp:Date.now()}),s}static async createSidebarItem(e){try{let{data:a,error:i}=await n.N.from("organization_sidebar_items").insert([e]).select().single();if(i){var t;if("42P01"===i.code)throw Error('Database table "organization_sidebar_items" does not exist. Please run the database setup SQL first.');if("23505"===i.code)throw Error("A sidebar item with this slug already exists for this organization.");if(null==(t=i.message)?void 0:t.includes("timeout"))throw Error("Database connection timeout. Please try again.");else throw Error("Database error: ".concat(i.message||"Unknown error"))}return this.clearCache(e.organization_id),a}catch(e){throw e}}static async updateSidebarItem(e,t){let{data:a,error:i}=await n.N.from("organization_sidebar_items").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(i)throw i;return a}static async deleteSidebarItem(e){let{error:t}=await n.N.from("organization_sidebar_items").delete().eq("id",e);if(t)throw t}static getAvailableIcons(){return[{value:"FileText",label:"Document"},{value:"Folder",label:"Folder"},{value:"Users",label:"Users"},{value:"Phone",label:"Phone"},{value:"Mail",label:"Email"},{value:"Settings",label:"Settings"},{value:"Code",label:"Code"},{value:"Database",label:"Database"},{value:"Server",label:"Server"},{value:"Network",label:"Network"},{value:"Shield",label:"Security"},{value:"Key",label:"Key"},{value:"Lock",label:"Lock"},{value:"Globe",label:"Globe"},{value:"Calendar",label:"Calendar"},{value:"Clock",label:"Clock"},{value:"Bug",label:"Bug"},{value:"AlertTriangle",label:"Alert"},{value:"CheckCircle",label:"Check"},{value:"Info",label:"Info"},{value:"Star",label:"Star"},{value:"Heart",label:"Heart"},{value:"Bookmark",label:"Bookmark"},{value:"Tag",label:"Tag"}]}static getAvailableCategories(){return[{value:"CLIENT CONTACT",label:"Client Contact"},{value:"CORE DOCUMENTATION",label:"Core Documentation"}]}}i.cache=new Map,i.CACHE_DURATION=3e4}},e=>{e.O(0,[5647,8441,5964,7358],()=>e(e.s=4710)),_N_E=e.O()}]);