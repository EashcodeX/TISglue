(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7796],{29869:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("upload",[["path",{d:"M12 3v12",key:"1x0j5s"}],["path",{d:"m17 8-5-5-5 5",key:"7q97r8"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}]])},54416:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},62525:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])},72161:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>z});var s=a(95155),r=a(12115),i=a(35695),o=a(42099),l=a(49509);class n{async makeGraphRequest(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a="".concat(this.baseUrl).concat(e),s=await fetch(a,{...t,headers:{Authorization:"Bearer ".concat(this.accessToken),"Content-Type":"application/json",...t.headers}});if(!s.ok){let e=await s.text();throw Error("Graph API error: ".concat(s.status," - ").concat(e))}return s.json()}async getPersonalDriveId(){if(this.driveId)return this.driveId;try{let e=await this.makeGraphRequest("/me/drive");return this.driveId=e.id,this.driveId}catch(e){throw Error("Failed to access personal OneDrive: ".concat(e.message))}}async createOrganizationFolder(e,t){try{let a=await this.ensureRootFolder(),s="".concat(t,"_").concat(e.slice(0,8));return(await this.makeGraphRequest("/me/drive/items/".concat(a,"/children"),{method:"POST",body:JSON.stringify({name:s,folder:{},"@microsoft.graph.conflictBehavior":"rename"})})).id}catch(e){throw Error("Failed to create organization folder: ".concat(e.message))}}async uploadFile(e,t,a,s,r){try{var i;let o,l=await this.getOrCreateOrganizationFolder(t,a),n=l;s&&(n=await this.getOrCreateCategoryFolder(l,s));let c=new Date().toISOString().replace(/[:.]/g,"-"),d="".concat(c,"_").concat(e.name);o=e.size<=4194304?await this.uploadSmallFile(e,n,d):await this.uploadLargeFile(e,n,d,r);let m=await this.getDownloadUrl(o.id),h=await this.createShareLink(o.id);return{id:o.id,name:o.name,size:o.size,mimeType:(null==(i=o.file)?void 0:i.mimeType)||"application/octet-stream",downloadUrl:m,shareUrl:h,folderPath:"".concat(this.rootFolder,"/").concat(a,"_").concat(t.slice(0,8)).concat(s?"/".concat(s):""),lastModified:o.lastModifiedDateTime,parentFolderId:n}}catch(e){throw Error("Failed to upload file: ".concat(e.message))}}async downloadFile(e){try{let t=await this.client.api("/me/drive/items/".concat(e,"/content")).get();if(t instanceof ArrayBuffer)return new Blob([t]);if(t instanceof Blob)return t;throw Error("Unexpected response type from OneDrive API")}catch(e){throw Error("Failed to download file: ".concat(e.message))}}async deleteFile(e){try{await this.client.api("/me/drive/items/".concat(e)).delete()}catch(e){throw Error("Failed to delete file: ".concat(e.message))}}async createShareLink(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"view";try{return(await this.client.api("/me/drive/items/".concat(e,"/createLink")).post({type:t,scope:"organization"})).link.webUrl}catch(e){throw Error("Failed to create share link: ".concat(e.message))}}async listFiles(e,t){try{let a=await this.getOrCreateOrganizationFolder(e,t),s=await this.client.api("/me/drive/items/".concat(a,"/children")).expand("children").get(),r=[];for(let i of s.value)if(i.file)r.push({id:i.id,name:i.name,size:i.size,mimeType:i.file.mimeType,folderPath:"".concat(this.rootFolder,"/").concat(t,"_").concat(e.slice(0,8)),lastModified:i.lastModifiedDateTime,parentFolderId:a});else if(i.folder){let a=await this.listFilesInFolder(i.id,"".concat(this.rootFolder,"/").concat(t,"_").concat(e.slice(0,8),"/").concat(i.name));r.push(...a)}return r}catch(e){throw Error("Failed to list files: ".concat(e.message))}}async ensureRootFolder(){try{await this.getPersonalDriveId();let e=await this.makeGraphRequest("/me/drive/root/children?$filter=name eq '".concat(this.rootFolder,"'"));if(e.value.length>0)return e.value[0].id;return(await this.makeGraphRequest("/me/drive/root/children",{method:"POST",body:JSON.stringify({name:this.rootFolder,folder:{},"@microsoft.graph.conflictBehavior":"rename"})})).id}catch(e){throw Error("Failed to ensure root folder: ".concat(e.message))}}async getOrCreateOrganizationFolder(e,t){let a="".concat(t,"_").concat(e.slice(0,8)),s=await this.ensureRootFolder();try{let e=await this.makeGraphRequest("/me/drive/items/".concat(s,"/children?$filter=name eq '").concat(a,"'"));if(e.value.length>0)return e.value[0].id;return(await this.makeGraphRequest("/me/drive/items/".concat(s,"/children"),{method:"POST",body:JSON.stringify({name:a,folder:{}})})).id}catch(e){throw Error("Failed to get or create organization folder: ".concat(e.message))}}async getOrCreateCategoryFolder(e,t){try{let a=await this.makeGraphRequest("/me/drive/items/".concat(e,"/children?$filter=name eq '").concat(t,"'"));if(a.value.length>0)return a.value[0].id;return(await this.makeGraphRequest("/me/drive/items/".concat(e,"/children"),{method:"POST",body:JSON.stringify({name:t,folder:{}})})).id}catch(e){throw Error("Failed to get or create category folder: ".concat(e.message))}}async uploadSmallFile(e,t,a){let s=await e.arrayBuffer(),r=await fetch("".concat(this.baseUrl,"/me/drive/items/").concat(t,":/").concat(a,":/content"),{method:"PUT",headers:{Authorization:"Bearer ".concat(this.accessToken),"Content-Type":e.type||"application/octet-stream"},body:s});if(!r.ok){let e=await r.text();throw Error("Upload failed: ".concat(r.status," - ").concat(e))}return r.json()}async uploadLargeFile(e,t,a,s){let r=(await this.client.api("/me/drive/items/".concat(t,":/").concat(a,":/createUploadSession")).post({item:{"@microsoft.graph.conflictBehavior":"rename"}})).uploadUrl,i=e.size,o=0;for(;o<i;){let t=Math.min(o+327680,i),a=e.slice(o,t),l=await a.arrayBuffer(),n=await fetch(r,{method:"PUT",headers:{"Content-Range":"bytes ".concat(o,"-").concat(t-1,"/").concat(i),"Content-Length":(t-o).toString()},body:l});if(s&&s({loaded:t,total:i,percentage:Math.round(t/i*100)}),201===n.status||200===n.status)return await n.json();if(202!==n.status)throw Error("Upload failed with status: ".concat(n.status));o=t}throw Error("Upload completed but no final response received")}async getDownloadUrl(e){try{return(await this.client.api("/me/drive/items/".concat(e)).get())["@microsoft.graph.downloadUrl"]||""}catch(e){return""}}async listFilesInFolder(e,t){let a=await this.client.api("/me/drive/items/".concat(e,"/children")).get(),s=[];for(let r of a.value)r.file&&s.push({id:r.id,name:r.name,size:r.size,mimeType:r.file.mimeType,folderPath:t,lastModified:r.lastModifiedDateTime,parentFolderId:e});return s}constructor(e){this.baseUrl="https://graph.microsoft.com/v1.0",this.driveId=null,this.accessToken=e,this.rootFolder=l.env.ONEDRIVE_ROOT_FOLDER||"ITGlue_Documents"}}class c{static async uploadDocument(e,t,a,s,r){try{let{data:i,error:l}=await o.N.from("documents").insert({organization_id:t,title:s.name||e.name,name:s.name||e.name,description:s.description,category:s.category,file_type:e.type||this.getFileTypeFromName(e.name),file_size:e.size,upload_status:"uploading"}).select().single();if(l)throw Error("Database error: ".concat(l.message));try{let l=new n(r),c=await l.uploadFile(e,t,a,s.category,s.onProgress),{data:d,error:m}=await o.N.from("documents").update({onedrive_file_id:c.id,onedrive_share_url:c.shareUrl,onedrive_download_url:c.downloadUrl,onedrive_folder_path:c.folderPath,upload_status:"completed",last_sync_at:new Date().toISOString()}).eq("id",i.id).select().single();if(m)throw Error("Failed to update document metadata: ".concat(m.message));return d}catch(e){throw await o.N.from("documents").update({upload_status:"failed"}).eq("id",i.id),e}}catch(e){throw Error("Failed to upload document: ".concat(e.message))}}static async downloadDocument(e,t){try{let{data:a,error:s}=await o.N.from("documents").select("*").eq("id",e).single();if(s)throw Error("Database error: ".concat(s.message));if(!a.onedrive_file_id)throw Error("Document not found in OneDrive");let r=new n(t);return await r.downloadFile(a.onedrive_file_id)}catch(e){throw Error("Failed to download document: ".concat(e.message))}}static async deleteDocument(e,t){try{let{data:a,error:s}=await o.N.from("documents").select("*").eq("id",e).single();if(s)throw Error("Database error: ".concat(s.message));if(a.onedrive_file_id)try{let e=new n(t);await e.deleteFile(a.onedrive_file_id)}catch(e){}let{error:r}=await o.N.from("documents").delete().eq("id",e);if(r)throw Error("Failed to delete from database: ".concat(r.message))}catch(e){throw Error("Failed to delete document: ".concat(e.message))}}static async getDocuments(e){try{let{data:t,error:a}=await o.N.from("documents").select("*").eq("organization_id",e).order("created_at",{ascending:!1});if(a)throw Error("Database error: ".concat(a.message));return t||[]}catch(e){throw Error("Failed to fetch documents: ".concat(e.message))}}static async getDocument(e){try{let{data:t,error:a}=await o.N.from("documents").select("*").eq("id",e).single();if(a){if("PGRST116"===a.code)return null;throw Error("Database error: ".concat(a.message))}return t}catch(e){throw Error("Failed to fetch document: ".concat(e.message))}}static async updateDocument(e,t){try{let{data:a,error:s}=await o.N.from("documents").update({...t,updated_at:new Date().toISOString()}).eq("id",e).select().single();if(s)throw Error("Database error: ".concat(s.message));return a}catch(e){throw Error("Failed to update document: ".concat(e.message))}}static async syncDocuments(e,t,a){try{let s=new n(a),r=await s.listFiles(e,t),{data:i,error:l}=await o.N.from("documents").select("*").eq("organization_id",e);if(l)throw Error("Database error: ".concat(l.message));let c=0,d=[];for(let t of r)if(!(null==i?void 0:i.find(e=>e.onedrive_file_id===t.id)))try{await o.N.from("documents").insert({organization_id:e,name:t.name,file_type:t.mimeType,file_size:t.size,onedrive_file_id:t.id,onedrive_share_url:t.shareUrl,onedrive_download_url:t.downloadUrl,onedrive_folder_path:t.folderPath,upload_status:"completed",last_sync_at:new Date().toISOString()}),c++}catch(e){d.push("Failed to sync ".concat(t.name,": ").concat(e.message))}return{synced:c,errors:d}}catch(e){throw Error("Failed to sync documents: ".concat(e.message))}}static getFileTypeFromName(e){var t;return({pdf:"application/pdf",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",txt:"text/plain",jpg:"image/jpeg",jpeg:"image/jpeg",png:"image/png",gif:"image/gif",zip:"application/zip",rar:"application/x-rar-compressed"})[(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""]||"application/octet-stream"}static getFileIcon(e){return e.startsWith("image/")?"Image":e.includes("pdf")||e.includes("word")||e.includes("document")?"FileText":e.includes("excel")||e.includes("spreadsheet")?"FileSpreadsheet":e.includes("powerpoint")||e.includes("presentation")?"FilePresentation":e.includes("zip")||e.includes("rar")?"Archive":e.startsWith("video/")?"Video":e.startsWith("audio/")?"Music":"File"}static formatFileSize(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB","TB"][t]}}var d=a(89006),m=a(95060),h=a(94615),u=a(40646),p=a(85339),x=a(29869),f=a(19946);let g=(0,f.A)("file",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}]]),w=(0,f.A)("cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);var y=a(54416);function v(e){let{organizationId:t,organizationName:a,category:i,onUploadComplete:o,onUploadError:l,maxFileSize:n=0x6400000,allowedTypes:c=[],multiple:d=!0}=e,[m,h]=(0,r.useState)([]),[f,v]=(0,r.useState)(!1),[j,b]=(0,r.useState)(!1),N=(0,r.useRef)(null),F=()=>Math.random().toString(36).substring(2,15),k=e=>{if(e.size>n)return"File size exceeds ".concat(C(n)," limit");if(c.length>0){var t;let a=null==(t=e.name.split(".").pop())?void 0:t.toLowerCase();if(!c.some(t=>t.startsWith(".")?t.substring(1)===a:e.type.startsWith(t)))return"File type not allowed. Allowed types: ".concat(c.join(", "))}return null},_=e=>{if(!e)return;let t=[];for(let a=0;a<e.length;a++){let s=e[a],r=k(s);t.push({file:s,id:F(),progress:0,status:r?"error":"pending",error:r||void 0})}d?h(e=>[...e,...t]):h(t.slice(0,1))},D=async e=>{try{h(t=>t.map(t=>t.id===e.id?{...t,status:"uploading",progress:0}:t));let s=new FormData;s.append("file",e.file),s.append("organizationId",t),s.append("organizationName",a),s.append("name",e.file.name),i&&s.append("category",i);let r=await fetch("/api/documents/simple-upload",{method:"POST",body:s});if(!r.ok){let e=await r.json();if(e.authRequired&&e.authUrl){window.location.href=e.authUrl;return}throw Error(e.error||"Upload failed")}let l=await r.json();h(t=>t.map(t=>t.id===e.id?{...t,status:"completed",progress:100}:t)),null==o||o(l.document)}catch(t){h(a=>a.map(a=>a.id===e.id?{...a,status:"error",error:t.message}:a)),null==l||l(t.message)}},A=async()=>{for(let e of(b(!0),m.filter(e=>"pending"===e.status)))await D(e);b(!1)},C=e=>{if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},S=m.filter(e=>"pending"===e.status).length,E=m.filter(e=>"completed"===e.status).length,U=m.filter(e=>"error"===e.status).length;return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center transition-colors ".concat(f?"border-blue-400 bg-blue-50/5":"border-gray-600 hover:border-gray-500"),onDragOver:e=>{e.preventDefault(),v(!0)},onDragLeave:e=>{e.preventDefault(),v(!1)},onDrop:e=>{e.preventDefault(),v(!1),_(e.dataTransfer.files)},children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)(w,{className:"w-8 h-8 text-blue-400"}),(0,s.jsx)(x.A,{className:"w-8 h-8 text-gray-400"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-white mb-2",children:"Upload to OneDrive Pro"}),(0,s.jsx)("p",{className:"text-gray-400 mb-4",children:"Drag and drop files here, or click to browse"}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["Max file size: ",C(n),c.length>0&&(0,s.jsxs)("span",{className:"block mt-1",children:["Allowed types: ",c.join(", ")]})]})]}),(0,s.jsx)("button",{onClick:()=>{var e;return null==(e=N.current)?void 0:e.click()},className:"px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg transition-colors",children:"Choose Files"}),(0,s.jsx)("input",{ref:N,type:"file",multiple:d,onChange:e=>_(e.target.files),className:"hidden",accept:c.length>0?c.join(","):void 0})]})}),m.length>0&&(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsxs)("h4",{className:"font-medium text-white",children:["Files (",m.length,")"]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[E>0&&(0,s.jsx)("button",{onClick:()=>{h(e=>e.filter(e=>"completed"!==e.status))},className:"text-sm text-gray-400 hover:text-white",children:"Clear completed"}),S>0&&(0,s.jsx)("button",{onClick:A,disabled:j,className:"px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 text-white rounded text-sm",children:j?"Uploading...":"Upload ".concat(S," files")})]})]}),(0,s.jsx)("div",{className:"space-y-2",children:m.map(e=>(0,s.jsxs)("div",{className:"flex items-center space-x-3 p-3 bg-gray-700 rounded",children:[(e=>{switch(e){case"completed":return(0,s.jsx)(u.A,{className:"w-5 h-5 text-green-400"});case"error":return(0,s.jsx)(p.A,{className:"w-5 h-5 text-red-400"});case"uploading":return(0,s.jsx)(x.A,{className:"w-5 h-5 text-blue-400 animate-pulse"});default:return(0,s.jsx)(g,{className:"w-5 h-5 text-gray-400"})}})(e.status),(0,s.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)("p",{className:"text-sm font-medium text-white truncate",children:e.file.name}),(0,s.jsx)("span",{className:"text-xs text-gray-400",children:C(e.file.size)})]}),"uploading"===e.status&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)("div",{className:"w-full bg-gray-600 rounded-full h-1",children:(0,s.jsx)("div",{className:"bg-blue-400 h-1 rounded-full transition-all",style:{width:"".concat(e.progress,"%")}})})}),e.error&&(0,s.jsx)("p",{className:"text-xs text-red-400 mt-1",children:e.error})]}),(0,s.jsx)("button",{onClick:()=>{var t;return t=e.id,void h(e=>e.filter(e=>e.id!==t))},className:"p-1 text-gray-400 hover:text-white",children:(0,s.jsx)(y.A,{className:"w-4 h-4"})})]},e.id))}),(E>0||U>0)&&(0,s.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-600",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[E>0&&(0,s.jsxs)("span",{className:"text-green-400",children:["✅ ",E," uploaded successfully"]}),U>0&&(0,s.jsxs)("span",{className:"text-red-400",children:["❌ ",U," failed"]})]})})]})]})}var j=a(57434);let b=(0,f.A)("image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var N=a(14186),F=a(84616),k=a(47924),_=a(66474),D=a(13052);let A=(0,f.A)("folder-open",[["path",{d:"m6 14 1.5-2.9A2 2 0 0 1 9.24 10H20a2 2 0 0 1 1.94 2.5l-1.54 6a2 2 0 0 1-1.95 1.5H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h3.9a2 2 0 0 1 1.69.9l.81 1.2a2 2 0 0 0 1.67.9H18a2 2 0 0 1 2 2v2",key:"usdka0"}]]);var C=a(21380),S=a(92657),E=a(91788),U=a(62525);function z(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),{selectedClient:a}=(0,d.tH)(),[l,n]=(0,r.useState)(null),[f,z]=(0,r.useState)([]),[O,M]=(0,r.useState)([]),[R,P]=(0,r.useState)(!0),[T,q]=(0,r.useState)(""),[L,I]=(0,r.useState)(!1),[B,G]=(0,r.useState)(!1),[H,V]=(0,r.useState)(""),[K,W]=(0,r.useState)(null);(0,r.useEffect)(()=>{J(),$()},[e.id]),(0,r.useEffect)(()=>{Z()},[f,T,L]);let J=async()=>{try{let{data:t,error:a}=await o.N.from("organizations").select("*").eq("id",e.id).single();if(a)throw a;n(t)}catch(e){}},$=async()=>{try{P(!0);let t=await c.getDocuments(e.id);z(t)}catch(e){}finally{P(!1)}},Z=()=>{let e=f;T&&(e=e.filter(e=>{var t;return e.name.toLowerCase().includes(T.toLowerCase())||(null==(t=e.category)?void 0:t.toLowerCase().includes(T.toLowerCase()))})),L||(e=e.filter(e=>!e.archived));let t=new Map;["Account Files","Applications","Archived","Change Management","Client Relations","Documents from Previous Provider","Knowledgebase","Server File NTFS Permissions","Site Photos"].forEach(e=>{t.set(e,[])}),e.forEach(e=>{let a=e.category||"Uncategorized";t.has(a)||t.set(a,[]),t.get(a).push(e)}),M(Array.from(t.entries()).map(e=>{let[t,a]=e;return{id:t.toLowerCase().replace(/\s+/g,"-"),name:t,expanded:!1,documents:a,documentCount:a.length}}))},Q=a=>{a.href&&("/"===a.href?t.push("/"):t.push("/organizations/".concat(e.id).concat(a.href)))},X=async e=>{try{let t=await fetch("/api/documents/".concat(e.id,"/download"));if(!t.ok){let e=await t.json();if(e.authRequired){window.location.href=e.authUrl;return}throw Error(e.error||"Download failed")}let a=await t.blob(),s=window.URL.createObjectURL(a),r=document.createElement("a");r.href=s,r.download=e.name,document.body.appendChild(r),r.click(),window.URL.revokeObjectURL(s),document.body.removeChild(r)}catch(e){alert("Failed to download: ".concat(e.message))}},Y=async e=>{try{var t;let a=await fetch("/api/documents/".concat(e.id,"/view"));if(!a.ok){let e=await a.json();if(e.authRequired){window.location.href=e.authUrl;return}throw Error(e.error||"Failed to load document info")}let s=await a.json();if(!s.viewable){let t='Document "'.concat(e.name,'" is not available for viewing.\n\n');"no_file_content"===s.reason?(t+="Reason: This document was created for testing purposes and contains only metadata.\n\n",t+="To view actual files:\n",t+="1. Complete Microsoft OneDrive authentication\n",t+='2. Upload new files using the "Upload to OneDrive" button\n',t+="3. Files will be stored in OneDrive and viewable here"):(t+="Status: ".concat(e.upload_status,"\n\n"),t+="Please wait for the upload to complete or try re-uploading the file."),alert(t);return}let r=await fetch("/api/documents/".concat(e.id,"/download"));if(!r.ok){let e=await r.json();if(e.authRequired){window.location.href=e.authUrl;return}throw Error(e.error||"Failed to download file")}let i=await r.blob(),o=window.URL.createObjectURL(i),l=null==(t=e.name.split(".").pop())?void 0:t.toLowerCase();if(["pdf"].includes(l||""))window.open(o,"_blank");else if(["jpg","jpeg","png","gif","svg","webp"].includes(l||""))window.open(o,"_blank");else if(["txt","md","json","xml","csv","log"].includes(l||""))window.open(o,"_blank");else if(["doc","docx","xls","xlsx","ppt","pptx"].includes(l||"")){let t=document.createElement("a");t.href=o,t.download=e.name,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(o),document.body.removeChild(t),alert('File "'.concat(e.name,'" has been downloaded. It will open with your default application.'))}else{let t=document.createElement("a");t.href=o,t.download=e.name,document.body.appendChild(t),t.click(),window.URL.revokeObjectURL(o),document.body.removeChild(t),alert('File "'.concat(e.name,'" has been downloaded to your Downloads folder.'))}}catch(e){alert("Failed to view file: ".concat(e.message))}},ee=async e=>{if(confirm('Are you sure you want to delete "'.concat(e.name,'"?')))try{W(e.id);let t=await fetch("/api/documents/".concat(e.id,"/delete"),{method:"DELETE"});if(!t.ok){let e=await t.json();if(e.authRequired){window.location.href=e.authUrl;return}throw Error(e.error||"Delete failed")}z(t=>t.filter(t=>t.id!==e.id))}catch(e){alert("Failed to delete: ".concat(e.message))}finally{W(null)}},et=O.reduce((e,t)=>e+t.documentCount,0);return R?(0,s.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,s.jsx)(h.default,{currentPage:"Organizations"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(m.A,{onItemClick:Q}),(0,s.jsx)("div",{className:"flex-1 p-6",children:(0,s.jsx)("div",{className:"flex items-center justify-center h-64",children:(0,s.jsx)("div",{className:"text-gray-400",children:"Loading documents..."})})})]})]}):(0,s.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white",children:[(0,s.jsx)(h.default,{currentPage:"Organizations"}),(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)(m.A,{onItemClick:Q}),(0,s.jsxs)("div",{className:"flex-1 p-6",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("div",{className:"w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center",children:(0,s.jsx)(j.A,{className:"w-6 h-6 text-white"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Documents"}),(0,s.jsx)("div",{className:"text-sm text-gray-400",children:null==l?void 0:l.name})]})]}),(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>{let t="/api/auth/microsoft?organization_id=".concat(e.id,"&return_url=").concat(encodeURIComponent(window.location.pathname));window.location.href=t},className:"flex items-center space-x-2 bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded text-sm",children:(0,s.jsx)("span",{children:"\uD83D\uDD10 Test Auth"})}),(0,s.jsxs)("button",{onClick:()=>G(!0),className:"flex items-center space-x-2 bg-blue-600 hover:bg-blue-700 px-4 py-2 rounded text-sm",children:[(0,s.jsx)(w,{className:"w-4 h-4"}),(0,s.jsx)(x.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"Upload to OneDrive"})]}),(0,s.jsxs)("button",{onClick:()=>t.push("/organizations/".concat(e.id,"/documents/new")),className:"flex items-center space-x-2 bg-green-600 hover:bg-green-700 px-4 py-2 rounded text-sm",children:[(0,s.jsx)(F.A,{className:"w-4 h-4"}),(0,s.jsx)("span",{children:"New"})]})]})]}),(0,s.jsx)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-4 flex-1",children:[(0,s.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,s.jsx)(k.A,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-4 h-4"}),(0,s.jsx)("input",{type:"text",placeholder:"Filter columns or Search keywords...",value:T,onChange:e=>q(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded pl-10 pr-4 py-2 text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,s.jsxs)("label",{className:"flex items-center space-x-2 text-sm text-gray-300",children:[(0,s.jsx)("input",{type:"checkbox",checked:L,onChange:e=>I(e.target.checked),className:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500"}),(0,s.jsx)("span",{children:"Include archived"})]})]}),(0,s.jsxs)("div",{className:"text-sm text-gray-400",children:[et," of ",et," Results"]})]})}),(0,s.jsx)("div",{className:"bg-gray-800 rounded-lg overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"w-full",children:[(0,s.jsx)("thead",{className:"bg-gray-700",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:(0,s.jsx)("input",{type:"checkbox",className:"rounded border-gray-600 bg-gray-700"})}),(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:"Name"}),(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:"Size"}),(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:"OneDrive Status"}),(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:"Updated"}),(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:"Category"}),(0,s.jsx)("th",{className:"text-left p-4 text-sm font-medium text-gray-300",children:"Actions"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-700",children:[O.map(e=>(0,s.jsxs)(r.Fragment,{children:[(0,s.jsxs)("tr",{className:"bg-gray-750",children:[(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("input",{type:"checkbox",className:"rounded border-gray-600 bg-gray-700"})}),(0,s.jsx)("td",{className:"p-4",colSpan:8,children:(0,s.jsxs)("button",{onClick:()=>{var t;return t=e.id,void M(e=>e.map(e=>e.id===t?{...e,expanded:!e.expanded}:e))},className:"flex items-center space-x-2 text-white hover:text-blue-400",children:[e.expanded?(0,s.jsx)(_.A,{className:"w-4 h-4"}):(0,s.jsx)(D.A,{className:"w-4 h-4"}),e.expanded?(0,s.jsx)(A,{className:"w-4 h-4 text-yellow-400"}):(0,s.jsx)(C.A,{className:"w-4 h-4 text-yellow-400"}),(0,s.jsx)("span",{children:e.name}),(0,s.jsxs)("span",{className:"text-gray-400 text-sm",children:["(",e.documentCount," documents)"]})]})})]}),e.expanded&&e.documents.map(e=>(0,s.jsxs)("tr",{className:"hover:bg-gray-700/50",children:[(0,s.jsx)("td",{className:"p-4",children:(0,s.jsx)("input",{type:"checkbox",className:"rounded border-gray-600 bg-gray-700"})}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-3 pl-6",children:[(e=>{var t;switch(null==(t=e.split(".").pop())?void 0:t.toLowerCase()){case"pdf":return(0,s.jsx)(j.A,{className:"w-4 h-4 text-red-400"});case"doc":case"docx":return(0,s.jsx)(j.A,{className:"w-4 h-4 text-blue-400"});case"jpg":case"jpeg":case"png":case"gif":return(0,s.jsx)(b,{className:"w-4 h-4 text-green-400"});default:return(0,s.jsx)(g,{className:"w-4 h-4 text-gray-400"})}})(e.name),(0,s.jsxs)("div",{children:[(0,s.jsx)("span",{className:"text-white",children:e.name}),e.description&&(0,s.jsx)("div",{className:"text-xs text-gray-400",children:e.description})]})]})}),(0,s.jsx)("td",{className:"p-4 text-gray-300",children:e.file_size?c.formatFileSize(e.file_size):"-"}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(e=>{switch(e){case"completed":return(0,s.jsx)("div",{title:"Uploaded to OneDrive",children:(0,s.jsx)(u.A,{className:"w-4 h-4 text-green-400"})});case"uploading":return(0,s.jsx)("div",{title:"Uploading to OneDrive",children:(0,s.jsx)(N.A,{className:"w-4 h-4 text-blue-400 animate-pulse"})});case"failed":return(0,s.jsx)("div",{title:"Upload failed",children:(0,s.jsx)(p.A,{className:"w-4 h-4 text-red-400"})});default:return(0,s.jsx)("div",{title:"Pending upload",children:(0,s.jsx)(N.A,{className:"w-4 h-4 text-gray-400"})})}})(e.upload_status),(0,s.jsx)("span",{className:"text-xs text-gray-400",children:"completed"===e.upload_status?"Synced":"uploading"===e.upload_status?"Uploading...":"failed"===e.upload_status?"Failed":"Pending"})]})}),(0,s.jsx)("td",{className:"p-4 text-gray-300",children:new Date(e.updated_at).toLocaleDateString()}),(0,s.jsx)("td",{className:"p-4 text-gray-300",children:e.category||"-"}),(0,s.jsx)("td",{className:"p-4",children:(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("button",{onClick:()=>Y(e),className:"p-1 text-gray-400 hover:text-green-400",title:"View document",children:(0,s.jsx)(S.A,{className:"w-4 h-4"})}),"completed"===e.upload_status&&e.onedrive_file_id&&(0,s.jsx)("button",{onClick:()=>X(e),className:"p-1 text-gray-400 hover:text-blue-400",title:"Download from OneDrive",children:(0,s.jsx)(E.A,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:()=>ee(e),disabled:K===e.id,className:"p-1 text-gray-400 hover:text-red-400 disabled:opacity-50",title:"Delete document",children:K===e.id?(0,s.jsx)(N.A,{className:"w-4 h-4 animate-spin"}):(0,s.jsx)(U.A,{className:"w-4 h-4"})})]})})]},e.id))]},e.id)),0===et&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"text-center p-8 text-gray-400",children:(0,s.jsxs)("div",{className:"flex flex-col items-center space-y-2",children:[(0,s.jsx)(w,{className:"w-8 h-8 text-gray-500"}),(0,s.jsx)("span",{children:"No documents found"}),(0,s.jsx)("button",{onClick:()=>G(!0),className:"text-blue-400 hover:text-blue-300 text-sm",children:"Upload your first document to OneDrive"})]})})})]})]})})})]})]}),B&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,s.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl mx-4 max-h-[90vh] overflow-y-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-white flex items-center space-x-2",children:[(0,s.jsx)(w,{className:"w-6 h-6 text-blue-400"}),(0,s.jsx)("span",{children:"Upload to OneDrive Pro"})]}),(0,s.jsx)("button",{onClick:()=>G(!1),className:"text-gray-400 hover:text-white",children:(0,s.jsx)(y.A,{className:"w-6 h-6"})})]}),(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Category (Optional)"}),(0,s.jsxs)("select",{value:H,onChange:e=>V(e.target.value),className:"w-full bg-gray-700 border border-gray-600 rounded px-3 py-2 text-white",children:[(0,s.jsx)("option",{value:"",children:"Select category..."}),(0,s.jsx)("option",{value:"Account Files",children:"Account Files"}),(0,s.jsx)("option",{value:"Applications",children:"Applications"}),(0,s.jsx)("option",{value:"Change Management",children:"Change Management"}),(0,s.jsx)("option",{value:"Client Relations",children:"Client Relations"}),(0,s.jsx)("option",{value:"Documents from Previous Provider",children:"Documents from Previous Provider"}),(0,s.jsx)("option",{value:"Knowledgebase",children:"Knowledgebase"}),(0,s.jsx)("option",{value:"Server File NTFS Permissions",children:"Server File NTFS Permissions"}),(0,s.jsx)("option",{value:"Site Photos",children:"Site Photos"})]})]}),(0,s.jsx)(v,{organizationId:e.id,organizationName:(null==l?void 0:l.name)||"Unknown Organization",category:H||void 0,onUploadComplete:e=>{z(t=>[e,...t]),G(!1)},onUploadError:e=>{},maxFileSize:0x6400000,multiple:!0})]})})]})}},84616:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]])},85339:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},91788:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]])},92657:(e,t,a)=>{"use strict";a.d(t,{A:()=>s});let s=(0,a(19946).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},94441:(e,t,a)=>{Promise.resolve().then(a.bind(a,72161))}},e=>{e.O(0,[5647,6441,7365,3930,8441,5964,7358],()=>e(e.s=94441)),_N_E=e.O()}]);