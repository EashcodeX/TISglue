(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3148],{42099:(e,s,t)=>{"use strict";t.d(s,{N:()=>i});let i=(0,t(55647).UU)("https://yhznjxfzpthmyyhbhihp.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Inloem5qeGZ6cHRobXl5aGJoaWhwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQyNDE0MzcsImV4cCI6MjA2OTgxNzQzN30.BlP9YoilaPopQgkZXZa-_WJPUIjnX9nTyYspaBV0Cqc")},61855:(e,s,t)=>{Promise.resolve().then(t.bind(t,83078))},83078:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var i=t(95155),n=t(12115),a=t(42099);function r(){let[e,s]=(0,n.useState)(!1),[t,r]=(0,n.useState)([]),l=e=>{r(s=>[...s,e])},o=async()=>{s(!0),r([]);try{l("\uD83D\uDD27 Setting up OneDrive integration database schema...");let{error:e}=await a.N.rpc("exec_sql",{sql:"\n        -- Add OneDrive-specific columns to documents table\n        ALTER TABLE documents \n        ADD COLUMN IF NOT EXISTS onedrive_file_id VARCHAR(255),\n        ADD COLUMN IF NOT EXISTS onedrive_share_url TEXT,\n        ADD COLUMN IF NOT EXISTS onedrive_download_url TEXT,\n        ADD COLUMN IF NOT EXISTS onedrive_folder_path VARCHAR(500),\n        ADD COLUMN IF NOT EXISTS upload_status VARCHAR(50) DEFAULT 'pending',\n        ADD COLUMN IF NOT EXISTS last_sync_at TIMESTAMP WITH TIME ZONE;\n\n        -- Create index for OneDrive file ID\n        CREATE INDEX IF NOT EXISTS idx_documents_onedrive_file_id ON documents(onedrive_file_id);\n        CREATE INDEX IF NOT EXISTS idx_documents_upload_status ON documents(upload_status);\n        CREATE INDEX IF NOT EXISTS idx_documents_last_sync ON documents(last_sync_at);\n      "});e?l("⚠️ Documents table update: ".concat(e.message)):l("✅ Documents table updated for OneDrive integration");let{error:s}=await a.N.rpc("exec_sql",{sql:"\n        CREATE TABLE IF NOT EXISTS microsoft_tokens (\n          id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n          user_id VARCHAR(255) NOT NULL,\n          organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE,\n          access_token TEXT NOT NULL,\n          refresh_token TEXT NOT NULL,\n          expires_at TIMESTAMP WITH TIME ZONE NOT NULL,\n          token_type VARCHAR(50) DEFAULT 'Bearer',\n          scope TEXT,\n          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n          updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),\n          UNIQUE(user_id, organization_id)\n        );\n\n        CREATE INDEX IF NOT EXISTS idx_microsoft_tokens_user_id ON microsoft_tokens(user_id);\n        CREATE INDEX IF NOT EXISTS idx_microsoft_tokens_org_id ON microsoft_tokens(organization_id);\n        CREATE INDEX IF NOT EXISTS idx_microsoft_tokens_expires_at ON microsoft_tokens(expires_at);\n      "});s?l("⚠️ Microsoft tokens table: ".concat(s.message)):l("✅ Microsoft tokens table created");let{error:t}=await a.N.rpc("exec_sql",{sql:"\n        CREATE TABLE IF NOT EXISTS onedrive_sync_log (\n          id UUID DEFAULT gen_random_uuid() PRIMARY KEY,\n          organization_id UUID REFERENCES organizations(id) ON DELETE CASCADE,\n          sync_type VARCHAR(50) NOT NULL, -- 'upload', 'download', 'delete', 'sync'\n          file_name VARCHAR(255),\n          onedrive_file_id VARCHAR(255),\n          status VARCHAR(50) NOT NULL, -- 'success', 'failed', 'pending'\n          error_message TEXT,\n          sync_duration_ms INTEGER,\n          created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()\n        );\n\n        CREATE INDEX IF NOT EXISTS idx_sync_log_org_id ON onedrive_sync_log(organization_id);\n        CREATE INDEX IF NOT EXISTS idx_sync_log_status ON onedrive_sync_log(status);\n        CREATE INDEX IF NOT EXISTS idx_sync_log_created_at ON onedrive_sync_log(created_at);\n      "});t?l("⚠️ OneDrive sync log table: ".concat(t.message)):l("✅ OneDrive sync log table created");let{error:i}=await a.N.rpc("exec_sql",{sql:"\n        UPDATE documents \n        SET upload_status = 'completed' \n        WHERE upload_status IS NULL OR upload_status = '';\n      "});i?l("⚠️ Updating existing documents: ".concat(i.message)):l("✅ Updated existing documents with default status"),l("\uD83C\uDF89 OneDrive integration database setup completed!"),l("\uD83D\uDCCB Next steps:"),l("  1. Configure Azure App Registration"),l("  2. Set environment variables"),l("  3. Test authentication flow")}catch(e){l("❌ Setup failed: ".concat(e.message))}s(!1)},d=async()=>{s(!0),r([]);try{l("\uD83E\uDDEA Testing database connection and schema...");let{data:e,error:s}=await a.N.from("documents").select("id, onedrive_file_id, upload_status").limit(1);s?l("❌ Documents table test failed: ".concat(s.message)):l("✅ Documents table structure is correct");let{data:t,error:i}=await a.N.from("microsoft_tokens").select("id").limit(1);i?l("❌ Microsoft tokens table test failed: ".concat(i.message)):l("✅ Microsoft tokens table is accessible");let{data:n,error:r}=await a.N.from("onedrive_sync_log").select("id").limit(1);r?l("❌ OneDrive sync log table test failed: ".concat(r.message)):l("✅ OneDrive sync log table is accessible"),l("\uD83C\uDF89 Database schema test completed!")}catch(e){l("❌ Test failed: ".concat(e.message))}s(!1)};return(0,i.jsxs)("div",{className:"min-h-screen bg-gray-900 text-white p-8",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"\uD83D\uDD27 OneDrive Integration Setup"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,i.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Database Schema Setup"}),(0,i.jsx)("p",{className:"text-gray-300 mb-6",children:"This will update your database schema to support OneDrive integration:"}),(0,i.jsxs)("ul",{className:"text-gray-300 text-sm space-y-2 mb-6",children:[(0,i.jsxs)("li",{children:["• ",(0,i.jsx)("strong",{children:"documents table"})," - Add OneDrive metadata columns"]}),(0,i.jsxs)("li",{children:["• ",(0,i.jsx)("strong",{children:"microsoft_tokens table"})," - Store authentication tokens"]}),(0,i.jsxs)("li",{children:["• ",(0,i.jsx)("strong",{children:"onedrive_sync_log table"})," - Track sync operations"]}),(0,i.jsxs)("li",{children:["• ",(0,i.jsx)("strong",{children:"indexes"})," - Optimize query performance"]})]}),(0,i.jsx)("button",{onClick:o,disabled:e,className:"w-full px-4 py-3 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-600 rounded text-white font-medium mb-3",children:e?"Setting Up...":"\uD83D\uDD27 Setup Database Schema"}),(0,i.jsx)("button",{onClick:d,disabled:e,className:"w-full px-4 py-2 bg-green-600 hover:bg-green-700 disabled:bg-gray-600 rounded text-white",children:e?"Testing...":"\uD83E\uDDEA Test Database Schema"})]}),(0,i.jsxs)("div",{className:"bg-gray-800 p-6 rounded-lg",children:[(0,i.jsx)("h2",{className:"text-lg font-semibold mb-4",children:"Configuration Guide"}),(0,i.jsxs)("div",{className:"space-y-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-blue-400 font-medium mb-2",children:"1. Azure App Registration"}),(0,i.jsxs)("ul",{className:"text-gray-300 text-sm space-y-1",children:[(0,i.jsx)("li",{children:"• Go to Azure Portal → App Registrations"}),(0,i.jsx)("li",{children:'• Create new registration: "ITGlue OneDrive Integration"'}),(0,i.jsx)("li",{children:"• Set redirect URI: http://localhost:3002/api/auth/callback/microsoft"}),(0,i.jsx)("li",{children:"• Add API permissions: Files.ReadWrite, Files.ReadWrite.All, User.Read"}),(0,i.jsx)("li",{children:"• Create client secret"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-green-400 font-medium mb-2",children:"2. Environment Variables"}),(0,i.jsxs)("div",{className:"bg-gray-700 p-3 rounded text-xs font-mono",children:[(0,i.jsx)("div",{children:"MICROSOFT_CLIENT_ID=your_client_id"}),(0,i.jsx)("div",{children:"MICROSOFT_CLIENT_SECRET=your_secret"}),(0,i.jsx)("div",{children:"MICROSOFT_TENANT_ID=your_tenant_id"}),(0,i.jsx)("div",{children:"MICROSOFT_REDIRECT_URI=http://localhost:3002/api/auth/callback/microsoft"}),(0,i.jsx)("div",{children:"ONEDRIVE_ROOT_FOLDER=ITGlue_Documents"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h3",{className:"text-purple-400 font-medium mb-2",children:"3. Install Dependencies"}),(0,i.jsx)("div",{className:"bg-gray-700 p-3 rounded text-xs font-mono",children:"npm install @microsoft/microsoft-graph-client"})]})]})]})]}),t.length>0&&(0,i.jsxs)("div",{className:"mt-8 bg-gray-800 p-6 rounded-lg",children:[(0,i.jsx)("h3",{className:"font-medium mb-4",children:"Setup Results:"}),(0,i.jsx)("div",{className:"space-y-1 text-sm font-mono max-h-96 overflow-y-auto",children:t.map((e,s)=>(0,i.jsx)("div",{className:e.includes("✅")?"text-green-400":e.includes("❌")?"text-red-400":e.includes("⚠️")?"text-yellow-400":e.includes("\uD83C\uDF89")?"text-blue-400":e.includes("\uD83D\uDCCB")?"text-purple-400":"text-gray-300",children:e},s))})]}),(0,i.jsxs)("div",{className:"mt-8 bg-blue-900/20 border border-blue-600 rounded-lg p-6",children:[(0,i.jsx)("h3",{className:"text-blue-400 font-semibold mb-4",children:"\uD83C\uDFAF Integration Benefits:"}),(0,i.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-blue-300 font-medium mb-2",children:"Cost Savings"}),(0,i.jsxs)("ul",{className:"text-blue-200 text-sm space-y-1",children:[(0,i.jsx)("li",{children:"• No Supabase storage costs"}),(0,i.jsx)("li",{children:"• Use existing OneDrive Pro subscription"}),(0,i.jsx)("li",{children:"• 1TB+ storage vs 1GB free tier"})]})]}),(0,i.jsxs)("div",{children:[(0,i.jsx)("h4",{className:"text-blue-300 font-medium mb-2",children:"Features"}),(0,i.jsxs)("ul",{className:"text-blue-200 text-sm space-y-1",children:[(0,i.jsx)("li",{children:"• Large file support (250GB per file)"}),(0,i.jsx)("li",{children:"• Built-in versioning and backup"}),(0,i.jsx)("li",{children:"• Enterprise security and compliance"}),(0,i.jsx)("li",{children:"• Office integration for editing"})]})]})]})]})]})}}},e=>{e.O(0,[5647,8441,5964,7358],()=>e(e.s=61855)),_N_E=e.O()}]);